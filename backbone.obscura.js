!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("_"),require("Backbone")):"function"==typeof define&&define.amd?define(["_","Backbone"],e):"object"==typeof exports?exports.Obscura=e(require("_"),require("Backbone")):(t.Backbone=t.Backbone||{},t.Backbone.Obscura=e(t._,t.Backbone))}(this,function(t,e){return function(t){function e(s){if(i[s])return i[s].exports;var r=i[s]={exports:{},id:s,loaded:!1};return t[s].call(r.exports,r,r.exports,e),r.loaded=!0,r.exports}var i={};return e.m=t,e.c=i,e.p="",e(0)}([function(t,e,i){function s(t,e){this._superset=t,this._filtered=new o(t,e),this._sorted=new h(this._filtered,e),this._paginated=new a(this._sorted,e),l(this._paginated,this),c.call(this,this._filtered,g),c.call(this,this._sorted,d),c.call(this,this._paginated,v),this.initialize(e)}var r=i(1),n=i(2),o=i(3),h=i(6),a=i(8),l=i(4),c=i(9),u={superset:function(){return this._superset},getFilteredLength:function(){return this._filtered.length},removeTransforms:function(){return this._filtered.resetFilters(),this._sorted.removeSort(),this._paginated.removePagination(),this},destroy:function(){this.stopListening(),this._filtered.destroy(),this._sorted.destroy(),this._paginated.destroy(),this.length=0,this.trigger("obscura:destroy")}},f=["filterBy","removeFilter","resetFilters","refilter","hasFilter","getFilters"],g=["filtered:add","filtered:remove","filtered:reset"],p=["setSort","reverseSort","removeSort"],d=["sorted:add","sorted:remove"],_=["setPerPage","setPage","getPerPage","getNumPages","getPage","hasNextPage","hasPrevPage","nextPage","prevPage","movePage","removePagination","firstPage","lastPage"],v=["paginated:change:perPage","paginated:change:page","paginated:change:numPages"],P=["add","create","remove","set","reset","sort","parse","sync","fetch","push","pop","shift","unshift"];r.each(f,function(t){u[t]=function(){var e=o.prototype[t].apply(this._filtered,arguments);return e===this._filtered?this:e}}),r.each(_,function(t){u[t]=function(){var e=a.prototype[t].apply(this._paginated,arguments);return e===this._paginated?this:e}}),r.each(p,function(t){u[t]=function(){var e=h.prototype[t].apply(this._sorted,arguments);return e===this._sorted?this:e}}),r.each(P,function(t){u[t]=function(){throw new Error("Backbone.Obscura: Unsupported method: "+t+"called on read-only proxy")}}),r.extend(s.prototype,u,n.Events),s=n.Collection.extend(s.prototype),s.FilteredCollection=o,s.SortedCollection=h,s.PaginatedCollection=a,t.exports=s},function(e,i){e.exports=t},function(t,i){t.exports=e},function(t,e,i){function s(){this._filterResultCache={}}function r(t){for(var e in this._filterResultCache)this._filterResultCache.hasOwnProperty(e)&&delete this._filterResultCache[e][t]}function n(t,e){this._filters[t]&&r.call(this,t),this._filters[t]=e,this.trigger("filtered:add",t)}function o(t){delete this._filters[t],r.call(this,t),this.trigger("filtered:remove",t)}function h(t){this._filterResultCache[t.cid]||(this._filterResultCache[t.cid]={});var e=this._filterResultCache[t.cid];for(var i in this._filters)if(this._filters.hasOwnProperty(i)&&(e.hasOwnProperty(i)||(e[i]=this._filters[i].fn(t)),!e[i]))return!1;return!0}function a(){var t=[];this._superset&&(t=this._superset.filter(p.bind(h,this))),this._collection.reset(t),this.length=this._collection.length}function l(t){if(this._filterResultCache[t.cid]={},h.call(this,t)){if(!this._collection.get(t.cid)){for(var e=this.superset().indexOf(t),i=null,s=e-1;s>=0;s-=1)if(this.contains(this.superset().at(s))){i=this.indexOf(this.superset().at(s))+1;break}i=i||0,this._collection.add(t,{at:i})}}else this._collection.get(t.cid)&&this._collection.remove(t);this.length=this._collection.length}function c(t){this._filterResultCache[t.cid]={},h.call(this,t)||this._collection.get(t.cid)&&this._collection.remove(t)}function u(t,e,i){"change:"===t.slice(0,7)&&c.call(this,arguments[1])}function f(t){this.contains(t)&&this._collection.remove(t),this.length=this._collection.length}function g(t){this._superset=t,this._collection=new d.Collection(t.toArray()),_(this._collection,this),this.resetFilters(),this.listenTo(this._superset,"reset sort",a),this.listenTo(this._superset,"add change",l),this.listenTo(this._superset,"remove",f),this.listenTo(this._superset,"all",u)}var p=i(1),d=i(2),_=i(4),v=i(5),P={defaultFilterName:"__default",filterBy:function(t,e){return e||(e=t,t=this.defaultFilterName),n.call(this,t,v(e)),a.call(this),this},removeFilter:function(t){return t||(t=this.defaultFilterName),o.call(this,t),a.call(this),this},resetFilters:function(){return this._filters={},s.call(this),this.trigger("filtered:reset"),a.call(this),this},superset:function(){return this._superset},refilter:function(t){return"object"==typeof t&&t.cid?l.call(this,t):(s.call(this),a.call(this)),this},getFilters:function(){return p.keys(this._filters)},hasFilter:function(t){return p.contains(this.getFilters(),t)},destroy:function(){this.stopListening(),this._collection.reset([]),this._superset=this._collection,this.length=0,this.trigger("filtered:destroy")}};p.extend(g.prototype,P,d.Events),t.exports=g},function(t,e,i){function s(t,e){function i(){e.length=t.length}function s(i){var s=r.toArray(arguments),n="change"===i||"change:"===i.slice(0,7);"reset"===i&&(e.models=t.models),r.contains(h,i)?(r.contains(["add","remove","destroy"],i)?s[2]=e:r.contains(["reset","sort"],i)&&(s[1]=e),e.trigger.apply(this,s)):n&&e.contains(s[1])&&e.trigger.apply(this,s)}var a={};return r.each(r.functions(n.Collection.prototype),function(e){r.contains(o,e)||(a[e]=function(){return t[e].apply(t,arguments)})}),r.extend(e,n.Events,a),e.listenTo(t,"all",i),e.listenTo(t,"all",s),e.models=t.models,i(),e}var r=i(1),n=i(2),o=["_onModelEvent","_prepareModel","_removeReference","_reset","add","initialize","sync","remove","reset","set","push","pop","unshift","shift","sort","parse","fetch","create","model","off","on","listenTo","listenToOnce","bind","trigger","once","stopListening"],h=["add","remove","reset","sort","destroy","sync","request","error"];t.exports=s},function(t,e,i){function s(t,e){return function(i){return i.get(t)===e}}function r(t,e){return function(i){return e(i.get(t))}}function n(t,e){return a.isArray(e)||(e=null),{fn:t,keys:e}}function o(t){var e=a.keys(t),i=a.map(e,function(e){var i=t[e];return a.isFunction(i)?r(e,i):s(e,i)}),o=function(t){for(var e=0;e<i.length;e++)if(!i[e](t))return!1;return!0};return n(o,e)}function h(t,e){return a.isFunction(t)?n(t,e):a.isObject(t)?o(t):void 0}var a=i(1);t.exports=h},function(t,e,i){function s(t){return c.isFunction(t)?t:function(e){return e.get(t)}}function r(t){return this._comparator?this._reverse?g(this._collection.toArray(),t,s(this._comparator)):c.sortedIndex(this._collection.toArray(),t,s(this._comparator)):this._superset.indexOf(t)}function n(t){var e=r.call(this,t);this._collection.add(t,{at:e})}function o(t){this.contains(t)&&this._collection.remove(t)}function h(t){this.contains(t)&&this._collection.indexOf(t)!==r.call(this,t)&&(this._collection.remove(t),n.call(this,t))}function a(){if(!this._comparator)return void this._collection.reset(this._superset.toArray());var t=this._superset.sortBy(this._comparator);this._collection.reset(this._reverse?t.reverse():t)}function l(t){this._superset=t,this._reverse=!1,this._comparator=null,this._collection=new u.Collection(t.toArray()),f(this._collection,this),this.listenTo(this._superset,"add",n),this.listenTo(this._superset,"remove",o),this.listenTo(this._superset,"change",h),this.listenTo(this._superset,"reset",a)}var c=i(1),u=i(2),f=i(4),g=i(7),p={setSort:function(t,e){return this._reverse="desc"===e,this._comparator=t,a.call(this),t?this.trigger("sorted:add"):this.trigger("sorted:remove"),this},reverseSort:function(){return this._reverse=!this._reverse,a.call(this),this},removeSort:function(){return this.setSort(),this},superset:function(){return this._superset},destroy:function(){this.stopListening(),this._collection.reset([]),this._superset=this._collection,this.length=0,this.trigger("sorted:destroy")}};c.extend(l.prototype,p,u.Events),t.exports=l},function(t,e,i){function s(t){return n.isFunction(t)?t:function(e){return e[t]}}function r(t,e,i,r){i=null==i?n.identity:s(i);for(var o=i.call(r,e),h=0,a=t.length;a>h;){var l=h+a>>>1;i.call(r,t[l])<o?a=l:h=l+1}return h}var n=i(1);t.exports=r},function(t,e,i){function s(){var t=this.getPage()*this.getPerPage(),e=t+this.getPerPage();return[t,e]}function r(){var t=s.call(this);this._collection.reset(this.superset().slice(t[0],t[1]))}function n(){var t=(this._totalPages,this.superset().length),e=this.getPerPage(),i=t%e===0?t/e:Math.floor(t/e)+1,s=this._totalPages!==i;return this._totalPages=i,s&&this.trigger("paginated:change:numPages",{numPages:i}),this.getPage()>=i?(this.setPage(i-1),!0):void 0}function o(){n.call(this)||r.call(this)}function h(t,e){for(var i=c.max([t.length,e.length]),s=0,r=0;i>s;s+=1,r+=1)if(t[s]!==e[r])if(e[s-1]===t[s])r-=1;else{if(e[s+1]!==t[s])return t[s];r+=1}}function a(t,e,i){if(!n.call(this)){var r=s.call(this),o=r[0],a=r[1],l=h(this.superset().slice(o,a),this._collection.toArray()),c=h(this._collection.toArray(),this.superset().slice(o,a));c&&this._collection.remove(c),l&&this._collection.add(l,{at:this.superset().indexOf(l)-o})}}function l(t,e){this._superset=t,this._collection=new u.Collection(t.toArray()),this._page=0,this.setPerPage(e&&e.perPage?e.perPage:null),f(this._collection,this),this.listenTo(this._superset,"add remove",a),this.listenTo(this._superset,"reset sort",o)}var c=i(1),u=i(2),f=i(4),g={removePagination:function(){return this.setPerPage(null),this},setPerPage:function(t){return this._perPage=t,o.call(this),this.setPage(0),this.trigger("paginated:change:perPage",{perPage:t,numPages:this.getNumPages()}),this},setPage:function(t){var e=0,i=this.getNumPages()-1;return t=t>e?t:e,t=i>t?t:i,t=0>t?0:t,this._page=t,r.call(this),this.trigger("paginated:change:page",{page:t}),this},getPerPage:function(){return this._perPage||this.superset().length||1},getNumPages:function(){return this._totalPages},getPage:function(){return this._page},hasNextPage:function(){return this.getPage()<this.getNumPages()-1},hasPrevPage:function(){return this.getPage()>0},nextPage:function(){return this.movePage(1),this},prevPage:function(){return this.movePage(-1),this},firstPage:function(){this.setPage(0)},lastPage:function(){this.setPage(this.getNumPages()-1)},movePage:function(t){return this.setPage(this.getPage()+t),this},superset:function(){return this._superset},destroy:function(){this.stopListening(),this._collection.reset([]),this._superset=this._collection,this._page=0,this._totalPages=0,this.length=0,this.trigger("paginated:destroy")}};c.extend(l.prototype,g,u.Events),t.exports=l},function(t,e,i){function s(t,e){r.each(e,function(e){this.listenTo(t,e,function(){var t=r.toArray(arguments);t.unshift(e),this.trigger.apply(this,t)})},this)}var r=i(1);t.exports=s}])});